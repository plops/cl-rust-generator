syntax = "proto3";
package graphical_proxy;

service RemoteBrowser {
  rpc StreamSession(stream ClientEvent) returns (stream ServerUpdate);
}

// --- CLIENT -> SERVER ---
message ClientEvent {
  oneof event {
    NavigateRequest navigate = 1;
    MouseInput mouse = 2;
    KeyboardInput keyboard = 3;
    ScrollInput scroll = 4;
    ViewportResize resize = 5;
    StreamConfig config = 6;
    SearchRequest search = 7;
  }
}

message NavigateRequest { string url = 1; }
message MouseInput { int32 x = 1; int32 y = 2; uint32 button = 3; }
message KeyboardInput { string key = 1; }
message ScrollInput { int32 delta_y = 1; }
message ViewportResize { uint32 width = 1; uint32 height = 2; }
message StreamConfig {
  bool enable_video = 1;
  bool enable_spatial_links = 2;
  bool force_keyframes = 3;
}
message SearchRequest { string query = 1; }

// --- SERVER -> CLIENT ---
message ServerUpdate {
  oneof update {
    VideoFrame frame = 1;
    SpatialMetadata spatial_data = 2;
    SearchResults search_results = 3;
    SystemStatus status = 4;
  }
}

message VideoFrame {
  bytes av1_data = 1;         // rav1e Output
  bool is_keyframe = 2;
  int32 viewport_x = 3;       // X-Position des aktuellen Bildausschnitts im Gesamtdokument
  int32 viewport_y = 4;       // Y-Position des aktuellen Bildausschnitts im Gesamtdokument
}

message SpatialMetadata {
  string title = 1;
  uint32 document_width = 2;
  uint32 document_height = 3;
  repeated LinkBox links = 4;
}

message LinkBox {
  uint32 id = 1;
  string url = 2;
  string label = 3;
  int32 x = 4; int32 y = 5; int32 width = 6; int32 height = 7;
}

message SearchResults {
  string query = 1;
  repeated SearchMatch matches = 2;
}

message SearchMatch {
  int32 absolute_y = 1;       // Position im Dokument f√ºr "Jump to"
  string context_snippet = 2; // Z.B. "...der[Suchbegriff] ist hier..."
}

message SystemStatus {
  string message = 1;
}
